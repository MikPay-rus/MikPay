<!doctype html><html lang="ru"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>MikPay</title>
<style>
:root{--bg1:#4e6cff;--bg2:#6fc1ff;--card:#fff;--text:#0f172a;--muted:#64748b;--line:#e5e7eb;--pri:#4e6cff;--bad:#ef4444;--sh:0 18px 50px rgba(0,0,0,.20);--r:18px;--toast:rgba(15,23,42,.92)}
body.dark{--bg1:#0b1220;--bg2:#111827;--card:#0f172a;--text:#e5e7eb;--muted:#94a3b8;--line:#1f2937;--pri:#5b7cfa;--sh:0 18px 60px rgba(0,0,0,.45);--toast:rgba(255,255,255,.12)}
*{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
body{margin:0;min-height:100vh;color:var(--text);display:flex;align-items:center;justify-content:center;padding:18px;
background:radial-gradient(900px 500px at 10% 10%,rgba(255,255,255,.35),transparent 60%),
radial-gradient(700px 420px at 90% 20%,rgba(255,255,255,.25),transparent 55%),
linear-gradient(135deg,var(--bg1),var(--bg2))}
.app{width:min(980px,100%);background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.22);border-radius:calc(var(--r)+12px);padding:14px;backdrop-filter:blur(10px)}
.panel{background:var(--card);border:1px solid var(--line);border-radius:var(--r);box-shadow:var(--sh);overflow:hidden;position:relative}
header{display:flex;justify-content:space-between;align-items:center;padding:14px;border-bottom:1px solid var(--line);gap:12px}
.brand{display:flex;gap:10px;align-items:center;user-select:none}
.logo{width:36px;height:36px;border-radius:14px;background:linear-gradient(135deg,var(--pri),#9ab2ff);box-shadow:0 14px 26px rgba(78,108,255,.35)}
.titles{display:flex;flex-direction:column;line-height:1.1}
.titles b{font-size:15px;letter-spacing:.2px}
.titles small{color:var(--muted);font-size:12px}
.pill{font-size:12px;color:var(--muted);border:1px solid var(--line);padding:6px 10px;border-radius:999px;white-space:nowrap}
.iconbtn{border:1px solid var(--line);background:transparent;color:var(--text);border-radius:12px;padding:10px 12px;cursor:pointer}
.iconbtn:disabled{opacity:.55;cursor:not-allowed}
</style>
<style>
.screen{padding:16px 16px 80px}
.title{font-size:22px;margin:6px 0 6px;text-align:center}
.sub{color:var(--muted);font-size:13px;margin:0 0 14px;text-align:center}
.grid{display:grid;grid-template-columns:1fr;gap:12px}
@media (min-width:900px){.grid.two{grid-template-columns:1fr 1fr}.screen{padding:18px 18px 86px}}
.card{border:1px solid var(--line);border-radius:16px;padding:14px;background:transparent}
.card h3{margin:0 0 10px;font-size:14px}
.muted{color:var(--muted);font-size:13px}
label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
input,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);outline:none;font-size:15px;background:transparent;color:var(--text)}
input:focus,textarea:focus{border-color:rgba(78,108,255,.55);box-shadow:0 0 0 3px rgba(78,108,255,.18)}
.btn{width:100%;border:none;border-radius:14px;padding:12px 14px;background:var(--pri);color:#fff;font-weight:900;cursor:pointer;margin-top:10px}
.btn.secondary{background:transparent;color:var(--text);border:1px solid var(--line);font-weight:900}
.btn.danger{background:var(--bad)}
.hidden{display:none!important}
.balance{font-size:34px;font-weight:950;letter-spacing:-.6px;margin:6px 0 0}
.row{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.row .btn{flex:1;margin-top:0;min-width:150px}
.list{margin-top:10px}
.item{border-top:1px solid var(--line);padding:10px 0;display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
.item:first-child{border-top:none;padding-top:0}
.tag{font-size:12px;border:1px solid var(--line);padding:6px 10px;border-radius:999px;color:var(--muted);white-space:nowrap}
</style>
<style>
.nav{position:absolute;left:0;right:0;bottom:0;border-top:1px solid var(--line);padding:10px;display:grid;grid-template-columns:repeat(5,1fr);gap:8px;background:linear-gradient(180deg,transparent,rgba(0,0,0,.02))}
.navbtn{border:1px solid var(--line);background:transparent;color:var(--muted);border-radius:14px;padding:10px 8px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:6px;font-size:11px}
.navbtn span{font-size:18px;line-height:1}
.navbtn.active{color:var(--text);border-color:rgba(78,108,255,.45);background:rgba(78,108,255,.10)}
.navbtn:disabled{opacity:.55;cursor:not-allowed}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;padding:18px;z-index:9998}
.modal{width:min(520px,100%);background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:var(--sh);overflow:hidden}
.modal header{border-bottom:1px solid var(--line)}
.close{cursor:pointer;border:1px solid var(--line);background:transparent;color:var(--text);padding:8px 10px;border-radius:12px}
.toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:var(--toast);color:#fff;padding:10px 12px;border-radius:14px;font-size:13px;box-shadow:0 16px 40px rgba(0,0,0,.35);max-width:min(560px,92%);z-index:9999}
body.dark .toast{color:var(--text)}
</style>
</head><body>
<div class="app"><div class="panel">
<header>
  <div class="brand">
    <div class="logo"></div>
    <div class="titles"><b>MikPay</b><small>–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ñ–∏–Ω—Ç–µ—Ö-—Å–µ—Ä–≤–∏—Å–∞</small></div>
    <span class="pill" id="rolePill">–ì–æ—Å—Ç—å</span>
  </div>
  <button class="iconbtn" id="gearBtn">‚öôÔ∏è</button>
</header>

<div class="screen" id="authScreen">
  <div class="title">–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
  <p class="sub">–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ö–Ω–æ–ø–∫–∏ ‚Äú—á–µ—Ä–µ–∑ –±–∞–Ω–∫‚Äù –æ—Ç–∫—Ä—ã–≤–∞—é—Ç —Å–∞–π—Ç –±–∞–Ω–∫–∞.</p>

  <div class="grid two">
    <div class="card">
      <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
      <label>Email</label><input id="regEmail" type="email" placeholder="example@mail.com" autocomplete="email">
      <label>–ü–∞—Ä–æ–ª—å</label><input id="regPass" type="password" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="new-password">
      <button class="btn" id="regBtn">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
      <div class="muted" style="margin-top:10px">–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è ‚Äî –≤–æ–π–¥–∏ —Å–ø—Ä–∞–≤–∞.</div>
    </div>

    <div class="card">
      <h3>–í—Ö–æ–¥</h3>
      <label>Email</label><input id="loginEmail" type="email" placeholder="example@mail.com" autocomplete="username">
      <label>–ü–∞—Ä–æ–ª—å</label><input id="loginPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
      <button class="btn" id="loginBtn">–í–æ–π—Ç–∏</button>
      <button class="btn secondary" id="forgotBtn">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</button>
    </div>
  </div>
</div>
<div class="screen hidden" id="appScreen">

  <!-- HOME -->
  <div id="homeView">
    <div class="grid two">
      <div class="card">
        <div class="muted">–ë–∞–ª–∞–Ω—Å</div>
        <div class="balance" id="bal">0 ‚ÇΩ</div>
        <div class="muted" style="margin-top:8px" id="who">‚Äî</div>

        <div class="row">
          <button class="btn" id="goPayBtn">–û–ø–ª–∞—Ç–∏—Ç—å</button>
          <button class="btn secondary" id="topupBtn">–ü–æ–ø–æ–ª–Ω–∏—Ç—å (–±—ã—Å—Ç—Ä–æ)</button>
          <button class="btn secondary" id="bankTopupBtn">–ü–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –±–∞–Ω–∫</button>
        </div>

        <div class="row">
          <button class="btn secondary" id="exportBtn2">–≠–∫—Å–ø–æ—Ä—Ç</button>
          <button class="btn secondary" id="themeBtn2">–¢–µ–º–∞</button>
          <button class="btn secondary" id="resetBtn2">–°–±—Ä–æ—Å</button>
        </div>
      </div>

      <div class="card">
        <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h3>
        <div class="list" id="opsList"><div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div></div>
        <button class="btn secondary" id="openHistoryBtn">–û—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
      </div>
    </div>
  </div>

  <!-- PAY -->
  <div class="hidden" id="payView">
    <div class="card">
      <h3>–û–ø–ª–∞—Ç–∞</h3>
      <div class="muted">–°–ø–∏—Å—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–∞–Ω–∫.</div>
      <label>–°—É–º–º–∞ (‚ÇΩ)</label><input id="payAmount" type="number" inputmode="numeric" placeholder="1000">
      <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><input id="payNote" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –∑–∞–∫–∞–∑ #123">
      <button class="btn" id="doPayBtn">–û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –±–∞–Ω–∫</button>
      <button class="btn secondary" id="payBackBtn">–ù–∞–∑–∞–¥</button>
    </div>
  </div>
<!-- TRANSFER -->
  <div class="hidden" id="trView">
    <div class="card">
      <h3>–ü–µ—Ä–µ–≤–æ–¥</h3>
      <label>–ö–æ–º—É (email)</label><input id="trTo" type="email" placeholder="friend@mail.com">
      <label>–°—É–º–º–∞ (‚ÇΩ)</label><input id="trAmount" type="number" inputmode="numeric" placeholder="500">
      <button class="btn" id="doTrBtn">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
      <button class="btn secondary" id="trBackBtn">–ù–∞–∑–∞–¥</button>
      <div class="muted" style="margin-top:10px">–ï—Å–ª–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî –±–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–∏—Ç—Å—è.</div>
    </div>
  </div>

  <!-- HISTORY -->
  <div class="hidden" id="histView">
    <div class="card">
      <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
      <label>–ü–æ–∏—Å–∫</label><input id="histSearch" type="text" placeholder="–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ / –æ–ø–ª–∞—Ç–∞ / –ø–µ—Ä–µ–≤–æ–¥">
      <div class="list" id="histList"><div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div></div>
      <button class="btn secondary" id="histBackBtn">–ù–∞–∑–∞–¥</button>
    </div>
  </div>

  <!-- PROFILE -->
  <div class="hidden" id="profView">
    <div class="card">
      <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
      <div class="list">
        <div class="item"><div><b>Email</b><div class="muted" id="profEmail">‚Äî</div></div><span class="tag">–∞–∫–∫–∞—É–Ω—Ç</span></div>
        <div class="item"><div><b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</b><div class="muted">wwwwliii@outlook.com</div></div><span class="tag">email</span></div>
      </div>
    </div>
  </div>

  <div class="nav">
    <button class="navbtn active" id="navHome"><span>üè†</span>–ì–ª–∞–≤–Ω–∞—è</button>
    <button class="navbtn" id="navPay"><span>üí≥</span>–û–ø–ª–∞—Ç–∞</button>
    <button class="navbtn" id="navTr"><span>üîÅ</span>–ü–µ—Ä–µ–≤–æ–¥</button>
    <button class="navbtn" id="navHist"><span>üßæ</span>–ò—Å—Ç–æ—Ä–∏—è</button>
    <button class="navbtn" id="navProf"><span>üë§</span>–ü—Ä–æ—Ñ–∏–ª—å</button>
  </div>

</div><!-- appScreen -->
</div></div><!-- panel/app -->
<div class="overlay hidden" id="settingsOv">
  <div class="modal" onclick="event.stopPropagation()">
    <header>
      <div class="brand"><div class="logo"></div><div class="titles"><b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b><small id="settingsEmail">‚Äî</small></div></div>
      <button class="close" id="settingsCloseBtn">‚úï</button>
    </header>
    <div class="screen" style="padding-bottom:16px">
      <div class="card"><h3>–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h3><button class="btn secondary" id="themeBtn">–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button></div>
      <div class="card" style="margin-top:12px"><h3>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
        <button class="btn secondary" id="changePassBtn">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
        <button class="btn secondary" id="forgotFromSettingsBtn">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</button>
      </div>
      <div class="card" style="margin-top:12px"><h3>–î–∞–Ω–Ω—ã–µ</h3>
        <button class="btn secondary" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
        <button class="btn secondary" id="resetAllBtn">–°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
      </div>
      <div class="card" style="margin-top:12px"><h3>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h3>
        <div class="muted">–ü–æ—á—Ç–∞: <b>wwwwliii@outlook.com</b></div>
        <button class="btn secondary" id="supportBtn">–ù–∞–ø–∏—Å–∞—Ç—å</button>
      </div>
      <button class="btn danger" id="logoutBtn">–í—ã–π—Ç–∏</button>
    </div>
  </div>
</div>

<div class="overlay hidden" id="supportOv">
  <div class="modal" onclick="event.stopPropagation()">
    <header>
      <div class="brand"><div class="logo"></div><div class="titles"><b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</b><small>wwwwliii@outlook.com</small></div></div>
      <button class="close" id="supportCloseBtn">‚úï</button>
    </header>
    <div class="screen" style="padding-bottom:16px">
      <label>–°–æ–æ–±—â–µ–Ω–∏–µ</label><textarea id="supportMsg" rows="5" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É‚Ä¶"></textarea>
      <button class="btn" id="sendSupportBtn">–ì–æ—Ç–æ–≤–æ</button>
      <div class="muted" style="margin-top:10px">–ë–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞ —ç—Ç–æ —Ñ–æ—Ä–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.</div>
    </div>
  </div>
</div>
<div class="overlay hidden" id="chgOv">
  <div class="modal" onclick="event.stopPropagation()">
    <header>
      <div class="brand"><div class="logo"></div><div class="titles"><b>–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</b><small>–ª–æ–∫–∞–ª—å–Ω–æ</small></div></div>
      <button class="close" id="chgCloseBtn">‚úï</button>
    </header>
    <div class="screen" style="padding-bottom:16px">
      <label>–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label><input id="oldPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label><input id="newPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <button class="btn" id="savePassBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<div class="overlay hidden" id="forgotOv">
  <div class="modal" onclick="event.stopPropagation()">
    <header>
      <div class="brand"><div class="logo"></div><div class="titles"><b>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</b><small>–≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ</small></div></div>
      <button class="close" id="forgotCloseBtn">‚úï</button>
    </header>
    <div class="screen" style="padding-bottom:16px">
      <div class="card"><div class="muted">–ü–∏—Å—å–º–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è. –ú–æ–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç—É—Ç.</div></div>
      <label>Email</label><input id="forgotEmail" type="email" placeholder="example@mail.com">
      <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label><input id="forgotNew" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <button class="btn" id="resetPassBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>
  </div>
</div>

<div class="toast hidden" id="toast"></div>
<script>
(()=>{"use strict";
const BANK_URL="https://www.sberbank.ru/";  // –Ω–∞–¥—ë–∂–Ω–∞—è —Å—Å—ã–ª–∫–∞
const K_USERS="mikpay_users",K_SESSION="mikpay_session",K_THEME="mikpay_theme";
const el=(id)=>document.getElementById(id);
const $$=(s)=>Array.from(document.querySelectorAll(s));
const safeJSON=(v,f)=>{try{return JSON.parse(v??"")}catch{return f}};
const loadUsers=()=>safeJSON(localStorage.getItem(K_USERS),{})||{};
const saveUsers=(u)=>localStorage.setItem(K_USERS,JSON.stringify(u));
const loadSession=()=>safeJSON(localStorage.getItem(K_SESSION),null);
const saveSession=(s)=>localStorage.setItem(K_SESSION,JSON.stringify(s));
const money=(n)=>Math.max(0,Math.floor(Number(n)||0)).toLocaleString("ru-RU")+" ‚ÇΩ";
const nowStr=()=>new Date().toLocaleString("ru-RU");
const toast=(m)=>{const t=el("toast");t.textContent=m;t.classList.remove("hidden");setTimeout(()=>t.classList.add("hidden"),1600)};
const openBank=()=>{
  // –Ω–∞ –Ø–Ω–¥–µ–∫—Å-–±—Ä–∞—É–∑–µ—Ä–µ –∏–Ω–æ–≥–¥–∞ —Ä–µ–∂–µ—Ç window.open ‚Äî –¥–µ–ª–∞–µ–º fallback
  const w=window.open(BANK_URL,"_blank","noopener,noreferrer");
  if(!w){ if(confirm("–ë—Ä–∞—É–∑–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –æ–∫–Ω–æ. –û—Ç–∫—Ä—ã—Ç—å –±–∞–Ω–∫ –≤ —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–µ?")) location.href=BANK_URL; }
};
const closeAll=()=>$$(".overlay").forEach(o=>o.classList.add("hidden"));
const openOv=(id)=>{closeAll();el(id).classList.remove("hidden")};
document.addEventListener("keydown",(e)=>{if(e.key==="Escape")closeAll()});
$$(".overlay").forEach(ov=>ov.addEventListener("click",()=>ov.classList.add("hidden")));
el("settingsCloseBtn").onclick=()=>el("settingsOv").classList.add("hidden");
el("supportCloseBtn").onclick=()=>el("supportOv").classList.add("hidden");
el("chgCloseBtn").onclick=()=>el("chgOv").classList.add("hidden");
el("forgotCloseBtn").onclick=()=>el("forgotOv").classList.add("hidden");
if(localStorage.getItem(K_THEME)==="dark")document.body.classList.add("dark");

const views={home:el("homeView"),pay:el("payView"),tr:el("trView"),hist:el("histView"),prof:el("profView")};
const navBtns={home:el("navHome"),pay:el("navPay"),tr:el("navTr"),hist:el("navHist"),prof:el("navProf")};
const navTo=(k)=>{Object.keys(views).forEach(x=>views[x].classList.toggle("hidden",x!==k));Object.keys(navBtns).forEach(x=>navBtns[x].classList.toggle("active",x===k))};

const current=()=>{const s=loadSession();if(!s||!s.email)return null;const u=loadUsers()[s.email];if(!u)return null;return{email:s.email,u}};
const addOp=(type,title,amount)=>{const c=current();if(!c)return;const users=loadUsers();users[c.email].ops=users[c.email].ops||[];users[c.email].ops.unshift({type,title,amount:Math.floor(Number(amount)||0),when:nowStr()});saveUsers(users)};
const render=()=>{const c=current();if(!c)return;
  el("rolePill").textContent="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
  el("bal").textContent=money(c.u.balance||0);
  el("who").textContent="–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: "+c.email;
  el("profEmail").textContent=c.email;
  const ops=c.u.ops||[];
  el("opsList").innerHTML=!ops.length?'<div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>':ops.slice(0,6).map(o=>`<div class="item"><div><b>${o.title}</b><div class="muted">${o.when}</div></div><span class="tag">${o.amount?money(o.amount):"‚Äî"}</span></div>`).join("");
  const q=(el("histSearch").value||"").trim().toLowerCase();
  const f=ops.filter(o=>!q||o.title.toLowerCase().includes(q)||o.when.toLowerCase().includes(q));
  el("histList").innerHTML=!f.length?'<div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>':f.slice(0,80).map(o=>`<div class="item"><div><b>${o.title}</b><div class="muted">${o.when}</div></div><span class="tag">${o.amount?money(o.amount):"‚Äî"}</span></div>`).join("");
};
const showAuth=()=>{el("authScreen").classList.remove("hidden");el("appScreen").classList.add("hidden");el("rolePill").textContent="–ì–æ—Å—Ç—å";el("gearBtn").disabled=true;$$(".navbtn").forEach(b=>b.disabled=true)};
const showApp=()=>{el("authScreen").classList.add("hidden");el("appScreen").classList.remove("hidden");el("gearBtn").disabled=false;$$(".navbtn").forEach(b=>b.disabled=false);navTo("home");render()};
Object.entries(navBtns).forEach(([k,b])=>b.onclick=()=>{navTo(k);render()});
el("openHistoryBtn").onclick=()=>{navTo("hist");render()};
el("histSearch").oninput=()=>render();
el("histBackBtn").onclick=()=>{navTo("home");render()};
el("goPayBtn").onclick=()=>navTo("pay");
el("payBackBtn").onclick=()=>{navTo("home");render()};
el("navTr").onclick=()=>navTo("tr");
el("trBackBtn").onclick=()=>{navTo("home");render()};

el("regBtn").onclick=()=>{const email=el("regEmail").value.trim().toLowerCase();const pass=el("regPass").value;
  if(!email||!pass)return toast("–ó–∞–ø–æ–ª–Ω–∏ email –∏ –ø–∞—Ä–æ–ª—å");
  const users=loadUsers(); if(users[email])return toast("–ê–∫–∫–∞—É–Ω—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
  users[email]={pass,balance:0,ops:[]}; saveUsers(users);
  toast("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω"); el("loginEmail").value=email; el("loginPass").value=pass;
};
el("loginBtn").onclick=()=>{const email=el("loginEmail").value.trim().toLowerCase();const pass=el("loginPass").value;
  const users=loadUsers(); if(!users[email]||users[email].pass!==pass)return toast("–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
  saveSession({email}); toast("–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω"); showApp();
};

el("topupBtn").onclick=()=>{const c=current();if(!c)return;
  const s=prompt("–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (‚ÇΩ):","1000"); if(s===null)return;
  const sum=Math.floor(Number(s)); if(!Number.isFinite(sum)||sum<=0)return toast("–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞");
  const users=loadUsers(); users[c.email].balance=(users[c.email].balance||0)+sum; saveUsers(users);
  addOp("topup","–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: +"+money(sum),sum); toast("–ì–æ—Ç–æ–≤–æ"); render();
};

el("bankTopupBtn").onclick=()=>{const c=current();if(!c)return toast("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ");
  toast("–û—Ç–∫—Ä—ã–≤–∞—é –±–∞–Ω–∫‚Ä¶"); openBank();
  setTimeout(()=>{const s=prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É, –∫–æ—Ç–æ—Ä—É—é –ø–æ–ø–æ–ª–Ω–∏–ª–∏ –≤ –±–∞–Ω–∫–µ (‚ÇΩ):","1000"); if(s===null)return;
    const sum=Math.floor(Number(s)); if(!Number.isFinite(sum)||sum<=0)return toast("–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞");
    const users=loadUsers(); users[c.email].balance=(users[c.email].balance||0)+sum; saveUsers(users);
    addOp("topup","–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–∞–Ω–∫: +"+money(sum),sum); toast("–î–æ–±–∞–≤–ª–µ–Ω–æ"); render();
  },300);
};

el("doPayBtn").onclick=()=>{const c=current();if(!c)return toast("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ");
  const sum=Math.floor(Number(el("payAmount").value||0)); const note=(el("payNote").value||"").trim();
  if(!Number.isFinite(sum)||sum<=0)return toast("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É");
  const users=loadUsers(); const bal=users[c.email].balance||0; if(sum>bal)return toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
  users[c.email].balance=bal-sum; saveUsers(users);
  addOp("pay","–û–ø–ª–∞—Ç–∞: -"+money(sum)+(note?(" ‚Ä¢ "+note):""),sum);
  toast("–û—Ç–∫—Ä—ã–≤–∞—é –±–∞–Ω–∫‚Ä¶"); render(); openBank();
};

el("doTrBtn").onclick=()=>{const c=current();if(!c)return;
  const to=(el("trTo").value||"").trim().toLowerCase();
  const sum=Math.floor(Number(el("trAmount").value||0));
  if(!to)return toast("–í–≤–µ–¥–∏—Ç–µ email –ø–æ–ª—É—á–∞—Ç–µ–ª—è");
  if(!Number.isFinite(sum)||sum<=0)return toast("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É");
  const users=loadUsers(); const bal=users[c.email].balance||0; if(sum>bal)return toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
  users[c.email].balance=bal-sum;
  if(users[to]){users[to].balance=(users[to].balance||0)+sum; users[to].ops=users[to].ops||[];
    users[to].ops.unshift({type:"transfer",title:"–ü–µ—Ä–µ–≤–æ–¥ –ø–æ–ª—É—á–µ–Ω: +"+money(sum),amount:sum,when:nowStr()})}
  saveUsers(users); addOp("transfer","–ü–µ—Ä–µ–≤–æ–¥: -"+money(sum)+" ‚Üí "+to,sum); toast("–ü–µ—Ä–µ–≤–æ–¥ —Å–æ–∑–¥–∞–Ω"); render();
};

el("gearBtn").onclick=()=>{const c=current();if(!c)return toast("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ"); el("settingsEmail").textContent=c.email; openOv("settingsOv")};
const toggleTheme=()=>{document.body.classList.toggle("dark"); localStorage.setItem(K_THEME,document.body.classList.contains("dark")?"dark":"light"); toast("–¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞")};
el("themeBtn").onclick=toggleTheme; el("themeBtn2").onclick=toggleTheme;

const exportData=()=>{const payload={users:loadUsers(),session:loadSession(),theme:localStorage.getItem(K_THEME)||"light",exportedAt:new Date().toISOString()};
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="mikpay_export.json";
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); toast("–≠–∫—Å–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤");
};
el("exportBtn2").onclick=exportData; el("exportBtn").onclick=exportData;

const resetAll=()=>{if(!confirm("–°–±—Ä–æ—Å–∏—Ç—å –±–∞–ª–∞–Ω—Å, –∏—Å—Ç–æ—Ä–∏—é –∏ –∞–∫–∫–∞—É–Ω—Ç—ã –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ?"))return;
  localStorage.removeItem(K_USERS); localStorage.removeItem(K_SESSION); closeAll(); toast("–î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã"); showAuth();
};
el("resetBtn2").onclick=resetAll; el("resetAllBtn").onclick=resetAll;

el("supportBtn").onclick=()=>openOv("supportOv");
el("sendSupportBtn").onclick=()=>{const msg=(el("supportMsg").value||"").trim(); if(!msg)return toast("–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"); el("supportMsg").value=""; toast("–ì–æ—Ç–æ–≤–æ"); el("supportOv").classList.add("hidden")};

el("changePassBtn").onclick=()=>openOv("chgOv");
el("savePassBtn").onclick=()=>{const c=current();if(!c)return toast("–ù–µ—Ç —Å–µ—Å—Å–∏–∏");
  const oldP=el("oldPass").value,newP=el("newPass").value; if(!oldP||!newP)return toast("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è");
  const users=loadUsers(); if(users[c.email].pass!==oldP)return toast("–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π");
  users[c.email].pass=newP; saveUsers(users); el("oldPass").value=""; el("newPass").value=""; toast("–ü–∞—Ä–æ–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω"); el("chgOv").classList.add("hidden");
};
const openForgot=()=>openOv("forgotOv");
el("forgotBtn").onclick=openForgot; el("forgotFromSettingsBtn").onclick=openForgot;
el("resetPassBtn").onclick=()=>{const email=(el("forgotEmail").value||"").trim().toLowerCase(); const np=el("forgotNew").value;
  if(!email||!np)return toast("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è");
  const users=loadUsers(); if(!users[email])return toast("–ê–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ");
  users[email].pass=np; saveUsers(users); toast("–ü–∞—Ä–æ–ª—å —Å–±—Ä–æ—à–µ–Ω"); el("forgotOv").classList.add("hidden"); el("loginEmail").value=email; el("loginPass").value=np;
};

el("logoutBtn").onclick=()=>{saveSession(null); closeAll(); toast("–í—ã –≤—ã—à–ª–∏"); showAuth()};

closeAll(); el("gearBtn").disabled=true; $$(".navbtn").forEach(b=>b.disabled=true);
const s=loadSession(),u=loadUsers(); if(s&&s.email&&u[s.email]) showApp(); else showAuth();
})()
</script>
</body></html>